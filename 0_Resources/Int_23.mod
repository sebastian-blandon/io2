reset;
model;

param N:= 60;               # Number of Tasks
param W:= 12;                # Number of WorkStations
param O:= 8;                # Number of Positions i
param B:= 1000;
param BigM:= 1045;     

set J:= 1..N;               # Set of Task j
set M:= 1..W;               # Set of WorkStations m
set I:= 1..O;               # Set of Positions i
set Prec within {J,J};      # Set Precedences k

param P{J,M};               # Processing Time Task j in WorkStation m
param r{M};                 # Release time WorkStation m


var X {J,M,I} binary;	    # 1 if Task j schedule in WorkStation m at Time i, 0 othrerwase
var Y {M,1..N+1} binary;
var T {M,0..O}>=0 integer;  # Completention Time of Task sheduled in WorkStation m on position i 
var C {J} >=0 integer;      # Completention Time of Task j
var Makespan >=0;

data;

param P: 1  2  3  4  5  6  7  8  9  10  11  12:=
1	1000	1000	8	8	1000	1000	8	1000	1000	1000	1000	8
2	10	1000	1000	1000	1000	10	10	1000	1000	1000	10	1000
3	1000	6	1000	1000	6	1000	1000	1000	6	1000	6	1000
4	7	1000	1000	1000	7	1000	1000	7	1000	7	1000	1000
5	3	1000	1000	1000	1000	3	1000	1000	3	1000	1000	3
6	1000	1000	5	5	1000	1000	1000	5	1000	1000	1000	5
7	1000	4	1000	1000	4	1000	4	1000	1000	4	1000	1000
8	1000	4	1000	1000	4	1000	1000	1000	4	1000	4	1000
9	1000	1000	2	2	1000	1000	1000	1000	2	1000	2	1000
10	8	1000	1000	1000	8	1000	1000	8	1000	8	1000	1000
11	6	1000	1000	1000	1000	6	6	1000	1000	1000	6	1000
12	1000	1000	3	3	1000	1000	1000	3	1000	1000	1000	3
13	9	1000	1000	1000	1000	9	1000	1000	9	1000	1000	9
14	1000	1000	5	5	1000	1000	5	1000	1000	1000	1000	5
15	1000	1000	7	7	1000	1000	1000	7	1000	1000	1000	7
16	10	1000	1000	1000	10	1000	1000	10	1000	10	1000	1000
17	1000	1000	4	4	1000	1000	1000	4	1000	1000	1000	4
18	1000	8	1000	1000	8	1000	8	1000	1000	8	1000	1000
19	6	1000	1000	1000	1000	6	1000	1000	6	1000	1000	6
20	1000	2	1000	1000	2	1000	1000	1000	2	1000	2	1000
21	1000	1000	3	3	1000	1000	3	1000	1000	1000	1000	3
22	1000	1000	9	9	1000	1000	1000	1000	9	1000	9	1000
23	5	1000	1000	1000	1000	5	5	1000	1000	1000	5	1000
24	8	1000	1000	1000	1000	8	8	1000	1000	1000	8	1000
25	1000	9	1000	1000	9	1000	1000	1000	9	1000	9	1000
26	10	1000	1000	1000	10	1000	1000	10	1000	10	1000	1000
27	5	1000	1000	1000	1000	5	1000	1000	5	1000	1000	5
28	1000	1000	6	6	1000	1000	1000	6	1000	1000	1000	6
29	1000	1000	4	4	1000	1000	1000	1000	4	1000	4	1000
30	1000	4	1000	1000	4	1000	4	1000	1000	4	1000	1000
31	3	1000	1000	1000	1000	3	3	1000	1000	1000	3	1000
32	1000	1000	6	6	1000	1000	6	1000	1000	1000	1000	6
33	1000	1000	8	8	1000	1000	1000	8	1000	1000	1000	8
34	5	1000	1000	1000	1000	5	1000	1000	5	1000	1000	5
35	1000	1000	4	4	1000	1000	1000	1000	4	1000	4	1000
36	7	1000	1000	1000	7	1000	1000	7	1000	7	1000	1000
37	1000	2	1000	1000	2	1000	1000	1000	2	1000	2	1000
38	8	1000	1000	1000	1000	8	1000	1000	8	1000	1000	8
39	1000	10	1000	1000	10	1000	1000	1000	10	1000	10	1000
40	4	1000	1000	1000	4	1000	1000	4	1000	4	1000	1000
41	6	1000	1000	1000	1000	6	6	1000	1000	1000	6	1000
42	1000	1000	7	7	1000	1000	1000	1000	7	1000	7	1000
43	9	1000	1000	1000	9	1000	1000	9	1000	9	1000	1000
44	1000	1000	4	4	1000	1000	4	1000	1000	1000	1000	4
45	3	1000	1000	1000	1000	3	1000	1000	3	1000	1000	3
46	6	1000	1000	1000	1000	6	6	1000	1000	1000	6	1000
47	8	1000	1000	1000	8	1000	1000	8	1000	8	1000	1000
48	1000	1000	3	3	1000	1000	1000	1000	3	1000	3	1000
49	1000	1000	5	5	1000	1000	5	1000	1000	1000	1000	5
50	1000	1000	9	9	1000	1000	1000	9	1000	1000	1000	9
51	1000	2	1000	1000	2	1000	2	1000	1000	2	1000	1000
52	1000	1000	10	10	1000	1000	1000	10	1000	1000	1000	10
53	7	1000	1000	1000	1000	7	1000	1000	7	1000	1000	7
54	9	1000	1000	1000	9	1000	1000	9	1000	9	1000	1000
55	6	1000	1000	1000	1000	6	6	1000	1000	1000	6	1000
56	10	1000	1000	1000	1000	10	1000	1000	10	1000	1000	10
57	1000	1000	3	3	1000	1000	1000	3	1000	1000	1000	3
58	1000	1000	4	4	1000	1000	4	1000	1000	1000	1000	4
59	1000	6	1000	1000	6	1000	6	1000	1000	6	1000	1000
60	1000	2	1000	1000	2	1000	1000	1000	2	1000	2	1000;

param r:=
1  0
2  0
3  0
4  0
5  0
6  0
7  0
8  0
9  0
10 0
11 0
12 0;

set Prec:=
1   3
2   3
4   5
5   6
3   7
6   7
8   10
9   10
11  14
12  14
13  14
10  15
14  15
17  18
19  20
18  21
20  21
16  23
21  23
22  23
24  25
25  26
26  27
27  28
28  29
30  32
31  32
34  35
33  36
35  36
32  37
36  37
38  40
39  40
41  42
43  44
42  45
44  45
46  47
47  48
48  49
49  50
50  51
52  53
53  54
54  55
56  58
57  58
58  60
59  60;

minimize Cmax: Makespan;

subject to R0 {m in M}:
T[m,0] = r[m];

subject to R1 {j in J}:
sum{m in M, i in I} X[j,m,i] = 1;		

subject to R2 {m in M, i in I}:
sum{j in J} X[j,m,i] = Y[m,i];

subject to R3 {m in M, i in I}:
Y[m,i+1] <= Y[m,i];

subject to R4 {m in M, i in I}:
T[m,i] >= sum{j in J} (P[j,m] * X[j,m,i]) + T[m,i-1];

subject to R5 {j in J, m in M, i in I}:
C[j] >= T[m,i] + B*(X[j,m,i] - 1) ;

subject to R6 {j in J, m in M, i in I}:
C[j] <= T[m,i] + B * (X[j,m,i] - 1) + BigM * (1 - X[j,m,i]);

subject to R7 {(k,l) in Prec}:
C[l] >= C[k] + sum{m in M, i in I}(P[l,m] * X[l,m,i]);

subject to R8 {j in J}:
Makespan >= C[j];

subject to R9:
Makespan >= 42;

#expand;

option solver scip;
option show_stats 1;
option presolve 10;
#option highs_options 'alg:parallel=on tech:threads=8 tech:outlev_mp=1 tech:outlev=1 tech:miploglev=2';


solve Cmax;

display Cmax, C, {j in J, m in M, i in I: X[j,m,i] != 0} X[j,m,i];

